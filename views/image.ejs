<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>
    <%= image.title || 'Image' %>
  </title>
  <style>
    body {
      margin: 0;
      background: #f5f6fa;
    }

    .body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .photo-wrapper {
      text-align: center;
      margin-bottom: 20px;
    }

    .photo-wrapper img {
      max-width: 100%;
      max-height: 500px;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
    }

    h2 {
      margin: 10px 0;
      color: #333;
      text-align: center;
    }

    .meta {
      margin: 15px 0;
      padding: 12px;
      background: #f1f2f6;
      border-radius: 10px;
      font-size: 15px;
      color: #555;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .public {
      background: #2ecc71;
      color: white;
    }

    .private {
      background: #e74c3c;
      color: white;
    }

    .back-btn {
      display: inline-block;
      margin-top: 20px;
      text-decoration: none;
      background: #3498db;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      transition: background 0.3s;
    }

    .back-btn:hover {
      background: #2980b9;
    }

    .actions {
      margin-top: 20px;
    }

    .actions a,
    .actions button {
      display: inline-block;
      margin-right: 10px;
      text-decoration: none;
      background: #3498db;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      transition: background 0.3s;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î */
    .actions .download-btn {
      background: #27ae60;
    }

    .actions .download-btn:hover {
      background: #1e8449;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç */
    .actions .edit-btn {
      background: #f1c40f;
    }

    .actions .edit-btn:hover {
      background: #d4ac0d;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö */
    .actions .delete-btn {
      background: #e74c3c;
    }

    .actions .delete-btn:hover {
      background: #c0392b;
    }
  </style>
</head>

<body>

  <%- include('partials/header') %>

    <div class="body">
      <div class="container">
        <!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà -->
        <div class="photo-wrapper">
          <img src="<%= image.imageUrl || ('/uploads/' + image.filename) %>" alt="<%= image.title %>">
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ -->
        <h2>
          <%= image.title || 'Untitled' %>
        </h2>
        <div class="meta">
          <p><strong>Content:</strong>
            <%= image.content || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" %>
          </p>
          <p><strong>By:</strong>
            <%= image.user?.username || 'Unknown' %>
          </p>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏° Action -->
        <% 
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ user ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          const currentUserId = (typeof currentUser !== 'undefined' && currentUser) ? String(currentUser._id || currentUser.id || '') :
                                (typeof user !== 'undefined' && user) ? String(user._id || user.id || '') : '';
          const imageOwnerId = image && image.user ? String(image.user._id || image.user) : '';
          const isOwner = currentUserId && imageOwnerId && currentUserId === imageOwnerId;
        %>
        <div class="actions">
          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
          <a href="javascript:history.back()" class="back-btn">‚Üê Back</a>

          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ) -->
          <a href="<%= image.imageUrl || ('/uploads/' + image.filename) %>" download="<%= image.title || 'download' %>"
            class="download-btn">‚¨á Download</a>

          <!-- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏à‡∏∂‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö -->
          <% if (isOwner) { %>
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
            <a href="/image/<%= image._id || image.id %>/edit" class="edit-btn">‚úé Edit</a>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö -->
            <form action="/image/<%= image._id || image.id %>?_method=DELETE" method="POST" style="display:inline;"
              onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ?');">
              <button type="submit" class="delete-btn">üóë Delete</button>
            </form>
          <% } %>
        </div>

      </div>
    </div>
</body>

</html>